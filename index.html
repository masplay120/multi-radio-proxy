<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Multi-Radio</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #f4f6f8;
    margin: 0;
    padding: 0;
  }
  header {
    background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    padding: 1rem;
    text-align: center;
    font-size: 1.5rem;
    font-weight: 600;
  }
  .container {
    max-width: 900px;
    margin: 2rem auto;
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
  }
  th, td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }
  th {
    background: #f0f0f0;
  }
  button {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
    color: white;
  }
  .edit-btn { background: #ffb700; }
  .edit-btn:hover { background: #ffa500; }
  .delete-btn { background: #ff4d4f; }
  .delete-btn:hover { background: #e63946; }
  .add-btn { background: #4facfe; }
  .add-btn:hover { background: #00f2fe; }
  form {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }
  input {
    flex: 1;
    padding: 0.5rem;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  .form-group {
    flex: 1;
    min-width: 200px;
  }
  #login-container {
    text-align: center;
  }
  #login-container input {
    max-width: 300px;
  }
</style>
</head>
<body>

<header>Panel Multi-Radio</header>

<!-- Login -->
<div class="container" id="login-container">
  <h2>Acceso al Panel</h2>
  <form id="login-form">
    <input type="password" id="login-password" placeholder="Contraseña" required>
    <button type="submit" class="add-btn">Entrar</button>
  </form>
  <p id="login-error" style="color:red; display:none;">Contraseña incorrecta</p>
</div>

<!-- Panel -->
<div class="container" id="panel-container" style="display:none;">
  <h2>Administrar Radios</h2>
  <table id="radios-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>URL</th>
        <th>Mount</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3 id="form-title">Agregar Nueva Radio</h3>
  <form id="radio-form">
    <div class="form-group">
      <input type="text" id="radio-id" placeholder="ID (único)" required>
    </div>
    <div class="form-group">
      <input type="text" id="radio-url" placeholder="URL del stream" required>
    </div>
    <div class="form-group">
      <input type="text" id="radio-mount" placeholder="Mount" required>
    </div>
    <button type="submit" class="add-btn">Guardar</button>
  </form>
</div>

<script>
const loginForm = document.getElementById("login-form");
const loginPassword = document.getElementById("login-password");
const loginError = document.getElementById("login-error");
const loginContainer = document.getElementById("login-container");
const panelContainer = document.getElementById("panel-container");

const radiosTable = document.querySelector("#radios-table tbody");
const form = document.getElementById("radio-form");
const formTitle = document.getElementById("form-title");
const idInput = document.getElementById("radio-id");
const urlInput = document.getElementById("radio-url");
const mountInput = document.getElementById("radio-mount");

let editingId = null;
let token = null;

// Login integrado
loginForm.addEventListener("submit", async e => {
  e.preventDefault();
  const password = loginPassword.value.trim();
  if (!password) return;

  try {
    const res = await fetch("/admin-api/radios", {
      headers: { "Authorization": "Bearer " + password }
    });
    if (res.status === 200) {
      token = password;
      loginContainer.style.display = "none";
      panelContainer.style.display = "block";
      loadRadios();
    } else {
      loginError.style.display = "block";
    }
  } catch (err) {
    console.error(err);
    loginError.style.display = "block";
  }
});

// Cargar radios
async function loadRadios() {
  try {
    const res = await fetch("/admin-api/radios", {
      headers: { "Authorization": "Bearer " + token }
    });
    if (res.status === 401) {
      alert("Contraseña incorrecta");
      return;
    }
    const radios = await res.json();
    renderTable(radios);
  } catch (err) {
    console.error(err);
  }
}

// Renderizar tabla
function renderTable(radios) {
  radiosTable.innerHTML = "";
  Object.keys(radios).forEach(id => {
    const radio = radios[id];
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${id}</td>
      <td>${radio.url}</td>
      <td>${radio.mount}</td>
      <td>
        <button class="edit-btn" onclick="editRadio('${id}', '${radio.url}', '${radio.mount}')">Editar</button>
        <button class="delete-btn" onclick="deleteRadio('${id}')">Eliminar</button>
      </td>
    `;
    radiosTable.appendChild(tr);
  });
}

// Editar radio
function editRadio(id, url, mount) {
  editingId = id;
  formTitle.textContent = `Editar Radio: ${id}`;
  idInput.value = id;
  idInput.disabled = true;
  urlInput.value = url;
  mountInput.value = mount;
}

// Eliminar radio
async function deleteRadio(id) {
  if (!confirm("¿Seguro que quieres eliminar esta radio?")) return;
  try {
    await fetch("/admin-api/radios/" + id, {
      method: "DELETE",
      headers: { "Authorization": "Bearer " + token }
    });
    loadRadios();
  } catch (err) {
    console.error(err);
  }
}

// Agregar o actualizar radio
form.addEventListener("submit", async e => {
  e.preventDefault();
  const id = idInput.value.trim();
  const url = urlInput.value.trim();
  const mount = mountInput.value.trim();

  if (!id || !url || !mount) return;

  try {
    await fetch("/admin-api/radios", {
      method: "POST",
      headers: { 
        "Authorization": "Bearer " + token,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ id, url, mount })
    });
    form.reset();
    formTitle.textContent = "Agregar Nueva Radio";
    idInput.disabled = false;
    editingId = null;
    loadRadios();
  } catch (err) {
    console.error(err);
  }
});
</script>

</body>
</html>
